<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="ERP-MAX" />
    <title>Product Card</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../CSS/nav.css" />
    <link rel="stylesheet" href="../CSS/productcss.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="shortcut icon" href="../images/Favicon.png" type="../image/x-icon" />
  </head>
  <body class="body">

    <nav class="navbar">
      <div class="container-fluid">
        <div class="navbar-left">
          <input
            type="image"
            src="../images/erpLogo.png"
            class="navbar-brand"
            style="height: 50px"
            onclick="location.href='index.html'"
          />
          <ul class="navbar-nav" style="display: inline-block">
            <li class="nav-item" style="display: inline-block; margin: 10px">
              <a class="nav-link" href="products.html">Products</a>
            </li>
            <li class="nav-item" style="display: inline-block; margin: 10px">
              <a class="nav-link" href="locations.html">Locations</a>
            </li>
            <li class="nav-item" style="display: inline-block; margin: 10px">
              <a class="nav-link" href="movements.html">Movements</a>
            </li>
            <li class="nav-item" style="display: inline-block; margin: 10px">
              <a class="nav-link" href="ReportTable.html">Reports</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>


    <div style="display: flex;">
      <input type="submit" class="backbtn" value="back" onclick="location.href='index.html'">
      <input type="submit" class="addNewProduct" value="Add New Product" onclick="location.href='addproductForm.html'">
    </div>
    <div class="container">
      <h1>Products</h1>
      <section class="sec1">
        <div id="product-container" class="d-flex flex-wrap gap-4"></div>
        <div id="pagination" class="pagination">
          <button id="prevPageBtn" class="page-btn" onclick="changePage('prev')">Previous</button>
          <span id="currentPage">Page </span>
          <button id="nextPageBtn" class="page-btn" onclick="changePage('next')">Next</button>
      </div>
      </section>
    </div>

    <script>
      let currentPage = 0;
      class Product{
        constructor(id, name, barcode){
          this.id=id;
          this.name=name;
          this.barcode=barcode;
        }
      }
      function fetchProducts(page) {
        fetch(`http://localhost:8080/api/v1/product?page=${page}`)
          .then(response => {
            if (!response.ok) throw new Error("No Available Data");
            return response.json();
          })
          .then(data => {
            const container = document.getElementById("product-container");
            container.innerHTML = "";
    
            const products = data.products;
            document.getElementById("currentPage").textContent = `Page ${data.pageNum+1}`;
    
            products.forEach(product => {
              const card = document.createElement("div");
              card.className = "card";
              card.id = product.id;
              card.style.width = "18rem";
              const prod = new Product(product.id,product.productName,product.productBarcode)
              // console.log(product.productName);
              // console.log(product.productBarcode);
              card.innerHTML = `
                <img src="../images/product.webp" class="card-img-top" alt="Product Image">
                <div class="card-body">
                  <h5 class="card-title">${product.productName}</h5>
                  <p class="card-text">Barcode: ${product.productBarcode}</p>
                  <a href="#" class="btn btn-primary" onclick='viewProduct(${JSON.stringify(prod)})'>View Details</a>
                  <a href="#" class="btn btn-success" onclick='editProduct(${JSON.stringify(prod)})'>Edit</a>
                </div>
              `;
              container.appendChild(card);
            });
          })
          .catch(error => {
            console.error("Error fetching products:", error);
          });
      }

      function viewProduct(product) {
        localStorage.setItem("selectedProduct", JSON.stringify(product));
        location.href= 'productDetails.html';
      }

      function editProduct(product) {
        localStorage.setItem("selectedProduct", JSON.stringify(product));
        location.href= 'editProduct.html';
      }

    
      function changePage(direction) {
        if (direction === 'next') {
          currentPage++;
        } else if (direction === 'prev' && currentPage > 0) {
          currentPage--;
        }
        fetchProducts(currentPage);
      }

      fetchProducts(currentPage);
      class product{
        constructor(id, name, barcode){
          this.id=id;
          this.name=name;
          this.barcode=barcode;
        }
      }
    </script>
    
  </body>
</html>
