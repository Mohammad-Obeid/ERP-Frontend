<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="ERP-MAX" />
    <title>Movements</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../CSS/nav.css" />
    <link rel="stylesheet" href="../CSS/movecss.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="shortcut icon" href="../images/Favicon.png" type="../image/x-icon" />
  </head>
  <body class="body">

    <nav class="navbar">
      <div class="container-fluid">
        <div class="navbar-left">
          <input
            type="image"
            src="../images/erpLogo.png"
            class="navbar-brand"
            style="height: 50px"
            onclick="location.href='index.html'"
          />
          <ul class="navbar-nav" style="display: inline-block">
            <li class="nav-item" style="display: inline-block; margin: 10px">
              <a class="nav-link" href="products.html">Products</a>
            </li>
            <li class="nav-item" style="display: inline-block; margin: 10px">
              <a class="nav-link" href="locations.html">Locations</a>
            </li>
            <li class="nav-item" style="display: inline-block; margin: 10px">
              <a class="nav-link" href="movements.html">Movements</a>
            </li>
            <li class="nav-item" style="display: inline-block; margin: 10px">
              <a class="nav-link" href="ReportTable.html">Reports</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
        <table class="table tabl">
            <thead>
                <tr>
                <th>Move</th>
                <th>Product ID</th>
                <th>Quantity</th>
                <th>From Location</th>
                <th>Into Location</th>
                <th>Time</th>
            </tr>
            </thead>
                <tbody id="tablebody">
                </tbody>
            </table>
        <div id="pagination" class="pagination">
            <button id="prevPageBtn" class="page-btn" onclick="changePage('prev')">Previous</button>
            <span id="currentPage">Page </span>
            <button id="nextPageBtn" class="page-btn" onclick="changePage('next')">Next</button>
        </div>
    </div>

    <script>
        let currentPage = 0;
        function fetchMoves(page){
            fetch(`http://localhost:8080/api/v1/product-movement?page=${currentPage}`)
                .then(response =>{
                    if(!response.ok)throw new Error ('No Moves Were Found');
                    return response.json();
                })
                .then(data=>{
                    document.getElementById("currentPage").textContent = `Page ${data.pageNum+1}`;
                    const container = document.getElementById('tablebody');
                    container.innerHTML = '';
                    const moves = data.moves;

                    moves.forEach(move => {
                        const row = document.createElement("tr")
                        row.id = move.id;
                        row.innerHTML = `
                                <td>${move.id}</td>
                                <td>${move.productId}</td>
                                <td>${move.quantity}</td>
                                <td>${move.fromLocation}</td>
                                <td>${move.toLocation}</td>
                                <td>${new Date(move.movementDate).toLocaleString()}</td>
                        `;
                        container.appendChild(row); 
                    });
                })
        }

        function changePage(direction) {
        if (direction === 'next') {
          currentPage++;
        } else if (direction === 'prev' && currentPage > 0) {
          currentPage--;
        }
        fetchMoves(currentPage);
      }

        fetchMoves(currentPage)
    </script>
  </body>
</html>